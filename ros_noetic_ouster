FROM ros:noetic-ros-base-focal

RUN apt update
RUN apt install -y libpcap-dev libtins-dev
RUN apt install -y                     \
    ros-$ROS_DISTRO-pcl-ros             \
    ros-$ROS_DISTRO-rviz
RUN apt install -y         \
    build-essential         \
    libeigen3-dev           \
    libjsoncpp-dev          \
    libspdlog-dev           \
    libcurl4-openssl-dev    \
    cmake
RUN source /opt/ros/$ROS_DISTRO/setup.bash
WORKDIR /opt
# using instructions from page
RUN git clone https://github.com/Krishtof-Korda/pcap-to-bag.git
RUN git clone https://github.com/ouster-lidar/ouster_example.git
RUN mkdir -p myworkspace/src
WORKDIR myworkspace
RUN ln -s ../ouster_example ./src/
RUN ln -s ../pcap-to-bag ./src/
RUN catkin_make -DCMAKE_BUILD_TYPE=Release
WORKDIR /opt
RUN mkdir -p ouster_ros_ws/src
WORKDIR ouster_ros_ws/src
RUN git clone https://github.com/ouster-lidar/ouster-ros.git
WORKDIR ../
RUN catkin_make --cmake-args -DCMAKE_BUILD_TYPE=Release
