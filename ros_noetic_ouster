FROM ros:noetic-ros-base-focal
ARG DEBIAN_FRONTEND=noninteractive
RUN apt update
RUN apt install -y libpcap-dev libtins-dev
RUN apt install -y                     \
    ros-$ROS_DISTRO-pcl-ros             \
    ros-$ROS_DISTRO-rviz
RUN apt install -y         \
    build-essential         \
    libeigen3-dev           \
    libjsoncpp-dev          \
    libspdlog-dev           \
    libcurl4-openssl-dev    \
    cmake
RUN . /opt/ros/$ROS_DISTRO/setup.sh
WORKDIR /opt
# using instructions from page
RUN apt install -y git
RUN git clone https://github.com/Krishtof-Korda/pcap-to-bag.git
RUN git clone https://github.com/ouster-lidar/ouster_example.git
RUN mkdir -p myworkspace/src
WORKDIR myworkspace
RUN ln -s ../ouster_example ./src/
RUN ln -s ../pcap-to-bag ./src/
RUN . /opt/ros/$ROS_DISTRO/setup.sh && catkin_make -DCMAKE_BUILD_TYPE=Release
WORKDIR /opt
RUN mkdir -p ouster_ros_ws/src
WORKDIR ouster_ros_ws/src
RUN git clone --recurse-submodules https://github.com/ouster-lidar/ouster-ros.git
WORKDIR ../
RUN . /opt/ros/$ROS_DISTRO/setup.sh  && catkin_make --cmake-args -DCMAKE_BUILD_TYPE=Release
## trying to make everything in same container
# inmstall the pcl libraries
RUN apt install libpcl-dev
WORKDIR /opt
# CMake
RUN apt-get install -y cmake
# google-glog + gflags
RUN apt-get install -y libgoogle-glog-dev libgflags-dev
# Use ATLAS for BLAS & LAPACK
RUN apt-get install -y libatlas-base-dev
# Eigen3
RUN apt-get install -y libeigen3-dev
# SuiteSparse (optional)
RUN apt-get install -y libsuitesparse-dev
RUN apt install -y wget 
RUN wget "http://ceres-solver.org/ceres-solver-2.1.0.tar.gz"
RUN tar  zxf ceres-solver-2.1.0.tar.gz --no-same-owner
RUN mkdir ceres-bin
WORKDIR ceres-bin
RUN cmake ../ceres-solver-2.1.0
RUN make -j3
RUN make test
# Optionally install Ceres, it can also be exported using CMake which
# allows Ceres to be used without requiring installation, see the documentation
# for the EXPORT_BUILD_DIR option for more information.
RUN make install
WORKDIR /opt
RUN mkdir -p aloam_ws/src
WORKDIR aloam_ws 
RUN git clone https://github.com/HKUST-Aerial-Robotics/A-LOAM.git
WORKDIR ../
RUN . /opt/ros/$ROS_DISTRO/setup.sh && catkin_make
RUN chmod -R a+rxw /opt
